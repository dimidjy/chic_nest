<?php

/**
 * @file
 * GraphQL Compose Commerce module file.
 */

use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\graphql_compose\Plugin\GraphQLComposeSchemaTypeManager;

/**
 * Implements hook_entity_type_alter().
 */
function graphql_compose_commerce_entity_type_alter(array &$entity_types) {
  /** @var \Drupal\Core\Entity\EntityTypeInterface[] $entity_types */
  if (isset($entity_types['commerce_product'])) {
    $entity_types['commerce_product']->set('graphql_compose_enabled', TRUE);
    $entity_types['commerce_product']->set('graphql_compose_type_name', 'CommerceProduct');
  }
  
  if (isset($entity_types['commerce_product_variation'])) {
    $entity_types['commerce_product_variation']->set('graphql_compose_enabled', TRUE);
    $entity_types['commerce_product_variation']->set('graphql_compose_type_name', 'CommerceProductVariation');
  }
}

/**
 * Implements hook_graphql_compose_print_types().
 */
function graphql_compose_commerce_graphql_compose_print_types(GraphQLComposeSchemaTypeManager $manager): void {
  // Use our schema extension service to register types.
  \Drupal::service('graphql_compose_commerce.schema_extension')->registerTypes($manager);
}

/**
 * Implements hook_graphql_compose_print_extensions().
 */
function graphql_compose_commerce_graphql_compose_print_extensions(GraphQLComposeSchemaTypeManager $manager): void {
  // We're now using entity type plugins with query_load_enabled
  // so we don't need to manually add query fields here.
} 